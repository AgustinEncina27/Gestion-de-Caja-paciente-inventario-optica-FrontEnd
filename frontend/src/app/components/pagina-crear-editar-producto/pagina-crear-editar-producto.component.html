<div class="d-flex justify-content-center my-5 cont">
  <div class="card bg-light text-dark shadow-sm" style="width: 80%;">
    <div class="card-header text-white" style="background-color: var(--color-principal);">{{titulo}}</div>
    <div class="card-body">
      <form #productoForm="ngForm" novalidate>

        <!-- Modelo + Categorías -->
        <div class="row mb-3">
          <div class="col-md-6">
            <label for="InputModelo" class="form-label fw-bold">Modelo</label>
            <input
              type="text"
              class="form-control"
              id="InputModelo"
              [(ngModel)]="modelo"
              name="modelo"
              required
            />
          </div>

          <div class="col-md-6">
            <p><label class="form-label fw-bold">Categoría</label></p>
            <div class="form-check m-1" *ngFor="let categoria of categorias">
              <input
                class="form-check-input"
                type="checkbox"
                [id]="'cat-' + categoria.id"
                [checked]="isCategorySelectedInCheckBox(categoria)"
                (change)="toggleCategorySelection(categoria)"
                name="categoria{{categoria.id}}"
              />
              <label class="form-check-label" [for]="'cat-' + categoria.id">{{categoria.nombre}}</label>
            </div>
          </div>
        </div>

        <div *ngIf="hayCategoriasSeleccionadas()">
          <!-- Marca + Descripción -->
          <div class="row mb-3">
            <div class="col-md-6">
              <p class="form-label fw-bold">Marca / Tratamiento</p>
              <input type="text" class="form-control mb-2" placeholder="Buscar marca..." [(ngModel)]="filtroMarca" name="filtroMarca" />
              <div class="border overflow-auto p-2 rounded bg-white" style="height: 200px;">
                <div class="form-check mx-1" *ngFor="let m of marcasFiltradas">
                  <input
                    class="form-check-input"
                    type="radio"
                    name="marca"
                    [id]="'marca-' + m.id"
                    (change)="selecionMarca(m)"
                    [checked]="marcaSeleccionado(m)"
                  />
                  <label class="form-check-label" [for]="'marca-' + m.id">
                    {{ m.nombre }}
                  </label>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <label class="form-label fw-bold" for="InputDescipcion">Descripción</label>
              <textarea class="form-control" id="InputDescipcion" [(ngModel)]="descripcion" name="descripcion"></textarea>
            </div>
          </div>
        </div>

        <div *ngIf="hayCategoriasSeleccionadas() && !esSoloCristalSeleccionado()">
          <!-- Material + Género -->
          <div class="row mb-3">
            <div class="col-md-6">
              <p class="form-label fw-bold">Material</p>
              <div class="border overflow-auto p-2 rounded bg-white" style="height: 200px;">
                <div class="form-check mx-1" *ngFor="let mp of materialesProducto">
                  <input
                    class="form-check-input"
                    type="radio"
                    name="materialProducto"
                    [id]="'mat-' + mp.id"
                    (change)="selecionMaterial(mp)"
                    [checked]="materialProductoSeleccionado(mp)"
                  />
                  <label class="form-check-label" [for]="'mat-' + mp.id">
                    {{ mp.nombre }}
                  </label>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <label class="form-label fw-bold">Género</label>
              <div class="form-check" *ngFor="let g of ['Hombre','Mujer','Unisex','Niño','Niña']">
                <input class="form-check-input" type="radio" name="genero" [id]="'gen-' + g"
                       (change)="selecionGenero(g)" [checked]="generoSeleccionado(g)" />
                <label class="form-check-label" [for]="'gen-' + g">{{ g }}</label>
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="hayCategoriasSeleccionadas()">
          <!-- Costo / Precio -->
          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label fw-bold" for="InputCosto">Costo</label>
              <input
                type="number"
                class="form-control"
                id="InputCosto"
                [(ngModel)]="costo"
                name="costo"
                (change)="calcularPrecio(costo)"
              />
            </div>
            <div class="col-md-6">
              <label class="form-label fw-bold" for="InputPrecio">Precio</label>
              <input
                type="number"
                class="form-control"
                id="InputPrecio"
                [(ngModel)]="precio"
                name="precio"
                required
              />
            </div>
          </div>
        </div>

        <div *ngIf="hayCategoriasSeleccionadas()">
          <!-- Local único + Stock + Proveedores -->
          <div class="row mb-3">
            <div class="col-md-6 mt-3">
              <p class="form-label fw-bold">Local</p>
              <div class="form-check mx-1" *ngFor="let local of locales">
                <input
                  class="form-check-input"
                  type="radio"
                  name="local"
                  [id]="'loc-' + local.id"
                  (change)="selecionLocal(local)"
                  [checked]="selectedLocalId === local.id"
                />
                <label class="form-check-label" [for]="'loc-' + local.id">
                  {{ local.nombre }}
                </label>
              </div>

              <label class="form-label fw-bold mt-3" for="InputStock">Stock</label>
              <input
                type="number"
                class="form-control"
                id="InputStock"
                [(ngModel)]="stock"
                name="stock"
                required
              />
            </div>

            <div class="col-md-6">
              <p><label class="form-label fw-bold">Proveedores</label></p>
              <input type="text" class="form-control mb-2" placeholder="Buscar proveedor..." [(ngModel)]="filtroProveedor" name="filtroProveedor" />
              <div class="border overflow-auto rounded bg-white" style="max-height: 200px;">
                <div class="form-check m-1" *ngFor="let p of proveedoresFiltrados">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    [id]="'prov-' + p.id"
                    [checked]="isProveedorSelectedInCheckBox(p)"
                    (change)="toggleProveedorSelection(p)"
                    name="prov{{p.id}}"
                  />
                  <label class="form-check-label" [for]="'prov-' + p.id">{{ p.nombre }}</label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Spinner -->
        <div *ngIf="isLoading" class="overlay">
          <div class="spinner"></div>
          <p>Guardando...</p>
        </div>

        <!-- Botones -->
        <div class="text-center mt-4">
          <button class="btn btn-secondary me-2" type="button" (click)="volver()">Volver</button>

          <button
            type="button"
            class="btn btn-success"
            (click)="editarProducto()"
            *ngIf="productoId != null"
            [disabled]="
              !productoForm.form.valid ||
              !marca?.id ||
              !selectedLocalId ||
              stock == null ||
              precio == null
            "
          >
            Editar Producto
          </button>
        </div>

      </form>
    </div>
  </div>
</div>
