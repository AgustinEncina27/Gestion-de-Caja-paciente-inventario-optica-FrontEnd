<div class="nuestroCatalogo d-flex flex-wrap justify-content-around">
  <p class="fw-bold my-4" style="font-size: 50px;">NUESTRO CATÁLOGO</p>
</div>

<div class="d-flex justify-content-evenly mb-4 filtros p-2">
  <!-- Buscar por modelo -->
  <div class="d-flex justify-content-between align-items-center" *ngIf="authService.hasRoles()">
    <div class="input-group">
      <input
        type="text"
        id="modeloInput"
        class="form-control"
        placeholder="Ingresa el modelo..."
        [(ngModel)]="modeloSeleccionado">
      <button class="btn btn-primary" (click)="buscarProductoPorModelo()">Buscar</button>
    </div>
  </div>

  <!-- Buscar por marca -->
  <div class="d-flex justify-content-between align-items-center" *ngIf="authService.hasRoles()">
    <div class="input-group">
      <input
        type="text"
        id="marcaInput"
        class="form-control"
        placeholder="Ingresa la marca..."
        [(ngModel)]="marcaSeleccionado">
      <button class="btn btn-primary" (click)="buscarProductoPorMarca()">Buscar</button>
    </div>
  </div>

  <!-- Crear producto -->
  <button class="btn btn-success m-1" *ngIf="authService.hasRole('ROLE_ADMIN')" [routerLink]="['/crearVariosProductos']">
    Crear producto
  </button>

  <!-- Registrar paciente -->
  <button class="btn btn-success m-1" [routerLink]="['/crearPaciente']">Registrar paciente</button>

  <!-- Limpiar filtros -->
  <div class="d-flex justify-content-between align-items-center" *ngIf="authService.hasRoles()">
    <button class="btn btn-secondary" (click)="limpiarFiltros()">Limpiar Filtros</button>
  </div>
</div>

<div class="alert alert-warning mx-5" role="alert" *ngIf="productos.length === 0">
  No se encontraron productos
</div>

<div class="container mt-5" *ngIf="productos.length > 0">
  <div class="table-responsive">
    <table class="table table-striped table-bordered table-hover">
      <thead class="table-dark">
        <tr>
          <th>Modelo</th>
          <th>Marca</th>
          <th>Categoría</th>
          <th>Material</th>
          <th>Género</th>
          <th *ngIf="authService.hasRole('ROLE_ADMIN')">Costo</th>
          <th>Precio</th>
          <th>Stock</th>
          <th>Descripción</th>
          <th *ngIf="authService.hasRole('ROLE_ADMIN')">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let p of productos">
          <td>{{ p.modelo }}</td>
          <td>{{ p.marcaNombre }}</td>
          <td>
            <div *ngFor="let c of p.categorias">
              <p class="card-text">{{ c.nombre }}</p>
            </div>
          </td>
          <td>{{ p.materialNombre || '' }}</td>
          <td>{{ p.genero || '' }}</td>
          <td *ngIf="authService.hasRole('ROLE_ADMIN')">${{ p.costo }}</td>
          <td>${{ p.precio }}</td>

          <!-- ÚNICO local + stock -->
          <td>Stock: {{ p.stock }}</td>

          <td>{{ p.descripcion }}</td>

          <td *ngIf="authService.hasRole('ROLE_ADMIN')">
            <button
              class="btn btn-primary btn-sm me-2"
              [routerLink]="['/editarProducto', p.id]"
              [queryParams]="{ fromPage: (paginador?.number ?? 0) }">
              Editar
            </button>
            <button class="btn btn-danger btn-sm" (click)="eliminarProducto(p)">Eliminar</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Paginador -->
<nav aria-label="Page navigation" *ngIf="paginador && paginador.totalPages > 1">
  <ul class="pagination justify-content-center mt-3">
    <li class="page-item" [class.disabled]="paginador.first">
      <a class="page-link cursor-pointer" (click)="paginaAnterior()" aria-label="Previous">
        <span aria-hidden="true">&laquo;</span>
      </a>
    </li>

    <li *ngFor="let page of pages" [class.active]="paginador.number === page" class="page-item">
      <a class="page-link cursor-pointer" (click)="cambiarPagina(page)">{{ page + 1 }}</a>
    </li>

    <li class="page-item" [class.disabled]="paginador.last">
      <a class="page-link cursor-pointer" (click)="paginaSiguiente()" aria-label="Next">
        <span aria-hidden="true">&raquo;</span>
      </a>
    </li>
  </ul>
</nav>


